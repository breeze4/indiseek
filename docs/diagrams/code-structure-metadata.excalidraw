{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "id": "title",
      "type": "text",
      "x": 60,
      "y": 20,
      "width": 430,
      "height": 37.8,
      "text": "Code Structure Metadata Tables",
      "fontSize": 28,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1e1e1e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "Code Structure Metadata Tables"
    },
    {
      "id": "subtitle",
      "type": "text",
      "x": 60,
      "y": 56,
      "width": 680,
      "height": 18.9,
      "text": "How Tree-sitter populates symbols & chunks from one AST parse, plus LLM-generated file summaries",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#868e96",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "How Tree-sitter populates symbols & chunks from one AST parse, plus LLM-generated file summaries"
    },
    {
      "id": "src-bg",
      "type": "rectangle",
      "x": 60,
      "y": 90,
      "width": 620,
      "height": 230,
      "strokeColor": "#adb5bd",
      "backgroundColor": "#dee2e6",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "src-hdr",
      "type": "text",
      "x": 70,
      "y": 98,
      "width": 400,
      "height": 16.2,
      "text": "INPUT — packages/vite/src/node/server/index.ts",
      "fontSize": 12,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#495057",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "INPUT — packages/vite/src/node/server/index.ts"
    },
    {
      "id": "src-code",
      "type": "text",
      "x": 70,
      "y": 120,
      "width": 320,
      "height": 193,
      "text": "interface ServerConfig {\n  port: number\n  hmr: boolean\n}\n\nexport function createServer(\n  config: ServerConfig\n): Server {\n  const server = new HttpServer(config.port)\n  return server\n}",
      "fontSize": 13,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1e1e1e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "interface ServerConfig {\n  port: number\n  hmr: boolean\n}\n\nexport function createServer(\n  config: ServerConfig\n): Server {\n  const server = new HttpServer(config.port)\n  return server\n}"
    },
    {
      "id": "annot1",
      "type": "text",
      "x": 420,
      "y": 120,
      "width": 180,
      "height": 29.7,
      "text": "← symbol #41 (interface)\n   chunk  #136",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1971c2",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "← symbol #41 (interface)\n   chunk  #136"
    },
    {
      "id": "annot2",
      "type": "text",
      "x": 420,
      "y": 208,
      "width": 180,
      "height": 29.7,
      "text": "← symbol #42 (function)\n   chunk  #137",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#2b8a3e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "← symbol #42 (function)\n   chunk  #137"
    },
    {
      "id": "process-label",
      "type": "text",
      "x": 60,
      "y": 335,
      "width": 550,
      "height": 14.85,
      "text": "Tree-sitter AST parse: each top-level declaration → 1 symbol row + 1 chunk row",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#2b8a3e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "Tree-sitter AST parse: each top-level declaration → 1 symbol row + 1 chunk row"
    },
    {
      "id": "sym-hdr",
      "type": "rectangle",
      "x": 60,
      "y": 360,
      "width": 430,
      "height": 30,
      "strokeColor": "#1971c2",
      "backgroundColor": "#1971c2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "sym-title",
      "type": "text",
      "x": 70,
      "y": 365,
      "width": 320,
      "height": 20.25,
      "text": "symbols — one row per named declaration",
      "fontSize": 15,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#ffffff",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "symbols — one row per named declaration"
    },
    {
      "id": "sym-body",
      "type": "rectangle",
      "x": 60,
      "y": 390,
      "width": 430,
      "height": 195,
      "strokeColor": "#dee2e6",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "sym-text",
      "type": "text",
      "x": 70,
      "y": 398,
      "width": 410,
      "height": 178,
      "text": "ROW 1   id=41  \"ServerConfig\"  kind=\"interface\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 1-4  signature: \"interface ServerConfig {\"\n\nROW 2   id=42  \"createServer\"  kind=\"function\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 6-11  signature: \"export function createServer(\"\n\nkinds: function | class | method | interface\n       type | enum | variable\nAll positions: 1-based lines, 0-based cols.\nparent_symbol_id: FK → self (methods → class)",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1e1e1e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "ROW 1   id=41  \"ServerConfig\"  kind=\"interface\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 1-4  signature: \"interface ServerConfig {\"\n\nROW 2   id=42  \"createServer\"  kind=\"function\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 6-11  signature: \"export function createServer(\"\n\nkinds: function | class | method | interface\n       type | enum | variable\nAll positions: 1-based lines, 0-based cols.\nparent_symbol_id: FK → self (methods → class)"
    },
    {
      "id": "chk-hdr",
      "type": "rectangle",
      "x": 520,
      "y": 360,
      "width": 430,
      "height": 30,
      "strokeColor": "#1971c2",
      "backgroundColor": "#1971c2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "chk-title",
      "type": "text",
      "x": 530,
      "y": 365,
      "width": 360,
      "height": 20.25,
      "text": "chunks — AST-scoped code slices (KEY TABLE)",
      "fontSize": 15,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#ffffff",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "chunks — AST-scoped code slices (KEY TABLE)"
    },
    {
      "id": "chk-body",
      "type": "rectangle",
      "x": 520,
      "y": 390,
      "width": 430,
      "height": 240,
      "strokeColor": "#dee2e6",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "chk-text",
      "type": "text",
      "x": 530,
      "y": 398,
      "width": 410,
      "height": 223,
      "text": "ROW 1   id=136  symbol_name=\"ServerConfig\"\n  chunk_type: \"interface\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 1-4   token_estimate: 12\n  content: \"interface ServerConfig {\\n  port: ...\"\n\nROW 2   id=137  symbol_name=\"createServer\"\n  chunk_type: \"function\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 6-11  token_estimate: 32\n  content: \"export function createServer(\\n  ...\"\n\nchunks.id = JOIN KEY → LanceDB & Tantivy\nOne chunk per top-level symbol.\n0 symbols → one \"module\" chunk = full file.",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1e1e1e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "ROW 1   id=136  symbol_name=\"ServerConfig\"\n  chunk_type: \"interface\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 1-4   token_estimate: 12\n  content: \"interface ServerConfig {\\n  port: ...\"\n\nROW 2   id=137  symbol_name=\"createServer\"\n  chunk_type: \"function\"\n  file: \"packages/vite/src/node/server/index.ts\"\n  lines: 6-11  token_estimate: 32\n  content: \"export function createServer(\\n  ...\"\n\nchunks.id = JOIN KEY → LanceDB & Tantivy\nOne chunk per top-level symbol.\n0 symbols → one \"module\" chunk = full file."
    },
    {
      "id": "rel-bg",
      "type": "rectangle",
      "x": 60,
      "y": 645,
      "width": 890,
      "height": 55,
      "strokeColor": "#e67700",
      "backgroundColor": "#fff3bf",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "rel-text",
      "type": "text",
      "x": 75,
      "y": 653,
      "width": 700,
      "height": 44.55,
      "text": "LINK:  symbol_name in chunks ≈ name in symbols  (string match per file, not a SQL FK)\nKEY:   chunks.id is the primary key that LanceDB and Tantivy both reference via chunk_id.\nUSE:   symbols → metadata (kind, signature).  chunks → actual source text for search & embedding.",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1e1e1e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "LINK:  symbol_name in chunks ≈ name in symbols  (string match per file, not a SQL FK)\nKEY:   chunks.id is the primary key that LanceDB and Tantivy both reference via chunk_id.\nUSE:   symbols → metadata (kind, signature).  chunks → actual source text for search & embedding."
    },
    {
      "id": "fsum-label",
      "type": "text",
      "x": 60,
      "y": 715,
      "width": 420,
      "height": 14.85,
      "text": "Gemini 2.0 Flash — separate pipeline step, 1 LLM call per file",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#e67700",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "Gemini 2.0 Flash — separate pipeline step, 1 LLM call per file"
    },
    {
      "id": "fsum-hdr",
      "type": "rectangle",
      "x": 60,
      "y": 735,
      "width": 890,
      "height": 30,
      "strokeColor": "#1971c2",
      "backgroundColor": "#1971c2",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "fsum-title",
      "type": "text",
      "x": 70,
      "y": 740,
      "width": 350,
      "height": 20.25,
      "text": "file_summaries — one row per source file",
      "fontSize": 15,
      "fontFamily": 2,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#ffffff",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "file_summaries — one row per source file"
    },
    {
      "id": "fsum-body",
      "type": "rectangle",
      "x": 60,
      "y": 765,
      "width": 890,
      "height": 150,
      "strokeColor": "#dee2e6",
      "backgroundColor": "#f8f9fa",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "roundness": { "type": 3 },
      "boundElements": [],
      "isDeleted": false
    },
    {
      "id": "fsum-text",
      "type": "text",
      "x": 70,
      "y": 773,
      "width": 600,
      "height": 133.65,
      "text": "file_path:   \"packages/vite/src/node/server/index.ts\"\nsummary:     \"Creates and configures the Vite dev server with HMR and middleware support.\"\nlanguage:    \"ts\"\nline_count:  425\n\nGenerated by: gemini-2.0-flash  (prompt: \"Summarize responsibility in one sentence\")\nInput: file content truncated to 30k chars.   Supports resume (skips existing).\nRate limit: 0.5s delay between files.\nUsed by: read_map tool to build navigable directory tree with summaries.",
      "fontSize": 11,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "strokeColor": "#1e1e1e",
      "isDeleted": false,
      "opacity": 100,
      "angle": 0,
      "groupIds": [],
      "rawText": "file_path:   \"packages/vite/src/node/server/index.ts\"\nsummary:     \"Creates and configures the Vite dev server with HMR and middleware support.\"\nlanguage:    \"ts\"\nline_count:  425\n\nGenerated by: gemini-2.0-flash  (prompt: \"Summarize responsibility in one sentence\")\nInput: file content truncated to 30k chars.   Supports resume (skips existing).\nRate limit: 0.5s delay between files.\nUsed by: read_map tool to build navigable directory tree with summaries."
    }
  ],
  "appState": {
    "viewBackgroundColor": "#ffffff",
    "gridSize": 20
  },
  "files": {}
}